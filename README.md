# 4GModem MobileProxy Configurator
Позволяет легко поднять свои мобильные прокси с импользованием USB модемов.

Софт тестировался и писался на не оригинальных модемах E3372h-153 ([megamarket](https://megamarket.ru/catalog/details/modem-3g-4g-version-d-e3372-4g-lte-600010941960/#?related_search=e3372)), а так же самых дешевых китайских по 800р с wi-fi разных наименований, с китайскими по 800р много проблем, не советую их использовать если не понимаете что делаете.

Инструкцию напишу на примере E3372h, так как их и советую использовать, названия меню будут плюс минус одинаковые а вот скришоты скорее всего не будут совпадать с вашими.
Инструкция поделена на 2 части: Настройка софта для поднятия прокси и настройка для работы смены айпи по ссылке.

В кратце о DHCP, это адрес вашего модема, тот что на наклейке, например у меня это 192.168.8.1 на E3372 и 192.168.100.1 на китайских. Софт использует его для функционала смены айпи и на этот адрес перенаправляет все запросы для работы проксей, но даже без функционала смены айпи если на двух модемах оставить одинаковые адреса dhcp то они могут начать конфликтовать и работать будет только один из всех что на одном адресе.
 
1 часть:
  Короткая инструкция:
  1 - Прописать разные DHCP адреса модемам если есть такая возможность.
  2 - Настроить модемы в режим стиков (чтоб отображались как сетевая карта в пк и не требовали запуск посторонних программ)
  3 - В файле config.py прописать айпи и порт где будет запущен сервер для функционала смены айпи по ссылке
  4 - Запустить софт и выбирая ваши модемы и следуя подсказкам настроить данные для прокси на каждый модем (для тех кто шарит может просто изменить данные в Settings.json)
  5 - Мобильные прокси готовы
  
  Длинная инструкция:
  1.1 - Посмотреть на наклейке где находится админка модема и данные для входа в нее. например у меня это 192.168.8.1 и admin/admin
  1.2 - Подключаете модем к компьютеру и подключаетесть к нему так как можете, затем в любом браузере даже без интернета ввести вместо адреса адрес с наклейки, у меня это 192.168.8.1 вы увидете что-то подобное:
  
  ![image](https://github.com/IsNaRm/4GModem-MobileProxy-Configurator/assets/11133034/453f3ff5-2242-4aef-927a-ef033b58fdd6)
  
  1.3 - Ищем в настройках слово DHCP

  ![image](https://github.com/IsNaRm/4GModem-MobileProxy-Configurator/assets/11133034/2c7839f8-52ec-4d32-ad2a-1048967e471f)

  1.4 - Делаем удобные нам адреса, например у первого модема 192.168.10.1, у второго 192.168.11.1, тоесть у всех должно быть 192.168.X.1, вместо X - число до 255.
        Маска у всех 255.255.255.0
        Начало и конце ip-адреса указывайте первые 3 числа как у айпи адреса а в конце 100 и 200, тоесть если айпи адрес 192.168.15.1 то начало и конец 192.168.15.100 и 192.168.15.200ю
        остальные настройки нам не интересны
  1.5 Сохраняете настройки, модем перезагрузится, теперь веб морда(то что на картинках выше) доступна по адресу что вы указывали выше.

  2. Вам нужно перевести ваш модем в режим стика, проще всего это сделать на модемах с прошивкой hi-lilnk, продавцы обычно указывают если установлена эта прошивка. На каких-то модемах нужно выключить вайфай, где то просто в настройках можно выбрать режим, тот модем что у меня изначально в этом режиме(сначала определяется как флешка с программой, после установки это программы в режиме стика). Тут нет универсального ответа гуглите свою модель со словами "как перевести в режим стика/свистка". Если у вас все получилось то в сетевых подключениях вы увидете такое подключение которое называется Remote NDIS based Internet Sharing Device

![image](https://github.com/IsNaRm/4GModem-MobileProxy-Configurator/assets/11133034/193e085f-5d4a-4495-a0ac-1125b2a942b7)

  3.1 В файле config.py прописать айпи и порт где будет запущен сервер для функционала смены айпи по ссылке. Если указать ip 127.0.0.1 то доступ будет только с вашего пк.
  3.2 Если хотите доступ с других пк то вам нужно узнать локальный ip адрес вашего компьютера. Для этого открываем консоль/командная строка/cmd и пишем там "ipconfig" без кавычек, у вас может быть несколько подключений, например от впн, от вайфай, от проводного интернета, у всех них будет разный локальный ip для вашего пк, смотрите по названю адаптера и берите оттуда IPv4-адрес, в 99% случаев он будет начинаться на 192.168.1
  3.3 порт можете прописать любой от 1030 до 65000, но не используйте 3000, 3001, 5000, 7000 и подобные так как их обычно используют другие программы например долфин, rdp.
  3.4. После этого доступ к смене айпи будет только у компьютеров которые подключены к той же сети что и вы, если вы хотите чтоб был доступ совсем из других мест то ваш нужно прокинуть порт что вы указали выше в интернет, обычно это платная услуга у провайдера, на эту тему есть много инструкций, тут я не буду это рассматривать.
  4.1 Запустить INSTALL.BAT дождаться выполнения, закрыть, затем запустить START.BAT
  4.2 После запуска вы увидете сколько обнаружено модемов, их данные:
    
![image](https://github.com/IsNaRm/4GModem-MobileProxy-Configurator/assets/11133034/6c2d75fb-8a65-4860-8889-d23ae08c4fae)

  На скришоте видно что у меня 2 модема:
    первый я немного настроил - http://192.168.8.1, Remote NDIS based Internet Sharing Device, 34:4B:50:00:00:00    Данные для доступа к прокси http://192.168.1.11:8001[http://192.168.1.11:5010/change_ip/344B50000000]
    http://192.168.8.1 - адресс для доступа к веб морде,
    Remote NDIS based Internet Sharing Device - название сетевого адаптера
    34:4B:50:00:00:00 - mac адресс модема
    данные прокси в формате ip:port[change_url] или ip:port:login:password[change_url] если будут указаны логин и пароль в след шагах

    второй видно что скрипт пишет нужно указать как минимум порт, если его не указать модем не будет использоваться для поднятия прокси
4.5 Чтоб настроить скрипт для работы с модемом нужно указать какой модем хотим настроить, в моем случае не настроен тот что под цифрой "2", ее и пишем в консоль.
4.6 После выбора модема у вас есть возможность указать порт, логин, пароль и модель модема, первые три думаю не требуют обьсянения, а к модели модема мы вернемся во второй части инструкции, она нужна для работы функционала смены айпи по ссылке.
4.7 После указания портов(обязательно), логина и пароля (их не обязательно) можем запустить прокси отправляя "0" в консоль.
5. После запуска прокси вы увдите зеленое сообщение о успешности запуска и по одной информационной строчки для каждого модема. Так же в консоль будет слаться информация на какие сайты вы хоходите через прокси.

  ![image](https://github.com/IsNaRm/4GModem-MobileProxy-Configurator/assets/11133034/df43bc78-5d2c-4df8-9edd-62c6f826ee5e)

5.1 На этом настройка прокси завершена.

2 часть. Настройка смены айпи по ссылке.
Нам нужно отловить запрос для 4-х действий на модеме, отключения интернета, включение только 3G и включение только 4G, подключения интернета. На большинстве модемов смена айпи происходит при выполнении действий в таком порядке. Рекомендую сначала проверить так ли это у вас. Покажу на примере отключения интернета, остальные делаются по схожему принципу.
  1. Заходим в веб морду и находим кнопочку или переключатель для отключения интернета.
  2. Открываем инструменты разработичка, в хроме - три точки в углу -> дополнительные инструменты, либо ctrl+shift+i. Переходим во вкладку Network, ставим галочку Preserve log и жмем кнопку Fetch/XHR (в новых версиях хрома может быть скрыта под request types)
![image](https://github.com/IsNaRm/4GModem-MobileProxy-Configurator/assets/11133034/aa2b051b-b791-43f6-a7d0-a5701c858efd)
  3. Смотрим на запросы и нажимаем кнопку отключения интернета, после нажатия появится нужный нам запрос, в моем случае запрос называется proc_post без приписок, жмем на него.

![image](https://github.com/IsNaRm/4GModem-MobileProxy-Configurator/assets/11133034/9a16a220-7ce6-4d42-a685-f35e08797698)

  4. из запроса нам нужно 4 вещи: адрес, тип запроса и тип данных. адрес и тип запроса смотрим во вкладке Headers
    
    4.1 Адрес - "/reqproc/proc_post" это нужно, "192.168.8.1" это не нужно так как мы его можем поменять и скрипт сам узнает это начало
    4.2 Тип запроса - "POST"
    
![image](https://github.com/IsNaRm/4GModem-MobileProxy-Configurator/assets/11133034/22b3ca0e-6cca-4f74-bc4f-b819223a2caf)

  4.3 данные смотрим в Payload (этой вкладки может не быть если тип запроса GET)
      нажмите view source 
      
![image](https://github.com/IsNaRm/4GModem-MobileProxy-Configurator/assets/11133034/858c9f78-5b9f-43c2-957c-23f6bcae6625)

    если данные начинаются и заканчиваются с {} или [] то тип данных json, иначе тип данных - data (нужно будет в след шагах)
    сами данные в моем случае это "isTest=false&notCallback=true&goformId=DISCONNECT_NETWORK"
5. Подытожим, для отключения интернета у нас есть:
  Адрес -  "/reqproc/proc_post"
  Тип запроса - "POST"
  Данные - "isTest=false&notCallback=true&goformId=DISCONNECT_NETWORK"
  Тип данных - data
6. Собираем и записываем их для остальных действий с модемом (режим 3G, 4G, включение интернета)
7. Открываем файл Devices.json и записываем туда все что собрали в формате:
  "name":{
   "order":["action_1", "action 2"...],
    "action 1":{"type":"", "address":"", "data/json":""},    
}
  где name удобное вам имя, я просто пишу модель модема,
order - порядок выполнения действий, например "order": ["disconnect", "set_3G", "set_4G", "connect"]
затем сами действия точно так же как написали в order.
в действиях указываем данные что собирали ранее, из примера выше это:
"type": "POST",
      "address": "/reqproc/proc_post",
      "data": "Test=false&notCallback=true&goformId=DISCONNECT_NETWORK"
  если у нас данные в формате json то нужно указать "json": "", а не "data":""
Сохраняем файл, на всякий случай проверьте что заполнили корректно все кавычки и скобки на сайте https://jsonviewer.stack.hu/, вставив во вкладку текст и нажав Viewer
![image](https://github.com/IsNaRm/4GModem-MobileProxy-Configurator/assets/11133034/efd6a5a0-2685-496b-8d62-34f5944b2f6b)

8. После того как записали данные в Devices.json перезапускаем бота если был запущен и в настроках модема выбираем нашу модель которую только что заполнили. Если у вас одинаковые модели модемов то можно выбрать на каждый модем одну и ту же модель, не нужно делать для каждого отдельно.
9. Запустите прокси и проверьте что все работает перейдя по ссылке для смены айпи на модеме на котором указана модель, если будет какая-то ошибка то она будет выведена в консоль

![image](https://github.com/IsNaRm/4GModem-MobileProxy-Configurator/assets/11133034/3fd3f747-3c14-440a-a25d-4662a258142e)




